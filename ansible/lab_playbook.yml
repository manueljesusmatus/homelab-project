---
- name: Desplegar contenedores en lab principal
  hosts: localhost
  vars:
    stacks:
      - traefik
      - portainer
      - watchtower
      - gitea
      - monitoreo
      - homarr
      - navidrome
  tasks:
    - name: Instalar Docker y agregar al grupo sudoers
      include_tasks: "stacks/docker.yml"
      tags:
        - install_docker

    - name: Detener servicios con Docker Compose en m√∫ltiples carpetas
      shell: "docker-compose -f {{ ROOT_DATA_DIR }}/homelab-project/docker/{{ item }}/docker-compose.yml down"
      loop: "{{ stacks }}"
      tags:
        - docker_compose_down

    - name: Ejecutar playbook de cada stack
      include_tasks: "stacks/{{ item }}.yml"
      loop: "{{ stacks }}"
